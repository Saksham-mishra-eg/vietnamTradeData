"use strict";(()=>{var e={};e.id=386,e.ids=[386],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},26420:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>S,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>y,serverHooks:()=>x,staticGenerationAsyncStorage:()=>v});var r={};a.r(r),a.d(r,{POST:()=>f});var n=a(49303),s=a(88716),i=a(60670),o=a(87070);let c=process.env.SENDGRID_API_KEY,l=process.env.SENDGRID_TO_EMAIL||process.env.FROM_EMAIL||"info@VietnamTradeData.com",p=process.env.FROM_EMAIL||"no-reply@VietnamTradeData.com";async function u(e){let t={personalizations:[{to:[{email:l}]}],from:{email:p},subject:e.subject,content:[{type:"text/plain",value:e.plain||""},{type:"text/html",value:e.html}]};e.attachments&&(t.attachments=e.attachments.map(e=>({content:e.content,filename:e.filename})));let a=await fetch("https://api.sendgrid.com/v3/mail/send",{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error("SendGrid error: "+await a.text());return{ok:!0}}async function m(e){let t=function(e){let t=`New contact form: ${e.inquiryType||"Contact"}`,a=[];for(let t of(a.push("<h2>New contact submission</h2>"),a.push("<ul>"),Object.keys(e)))"attachment"!==t&&a.push(`<li><strong>${t}:</strong> ${Array.isArray(e[t])?JSON.stringify(e[t]):String(e[t]??"")}</li>`);return a.push("</ul>"),e.attachment&&e.attachment.filename&&a.push(`<div>Attachment: ${e.attachment.filename}</div>`),{subject:t,html:a.join("\n"),plain:`New contact submission

${JSON.stringify(e,null,2)}`}}(e),a={subject:"We've received your message - VietnamTradeData",html:`<p>Hi ${e.firstName||""},</p><p>Thanks for contacting VietnamTradeData. We have received your message and will respond within 2-4 hours during business hours.</p><p>Summary:</p><pre>${JSON.stringify(e,null,2)}</pre>`,plain:`Hi ${e.firstName||""},

Thanks for contacting VietnamTradeData. We have received your message and will respond within 2-4 hours.

Summary:
${JSON.stringify(e,null,2)}`},r=e.attachment&&e.attachment.filename&&e.attachment.content?[{filename:String(e.attachment.filename),content:String(e.attachment.content)}]:void 0;if(c&&(await u({subject:t.subject,html:t.html,plain:t.plain,attachments:r}),e.email&&"string"==typeof e.email)){let t={personalizations:[{to:[{email:e.email}]}],from:{email:p},subject:a.subject,content:[{type:"text/plain",value:a.plain},{type:"text/html",value:a.html}]};await fetch("https://api.sendgrid.com/v3/mail/send",{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify(t)})}return{ok:!0}}var h=a(66677),d=a(79458);async function f(e){try{let t=await e.formData(),a={};for(let e of t.entries()){let t=e[0],r=e[1];if("attachment"===t&&r instanceof File){let e=await r.arrayBuffer(),t=Buffer.from(e).toString("base64");a.attachment={filename:(0,h.Z)(r.name),content:t}}else{let e="string"==typeof r?r:String(r),n=(0,h.Z)(e);try{a[t]=JSON.parse(n)}catch(e){a[t]=n}}}let r=a.email&&"string"==typeof a.email&&a.email||e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"anon";if(!await (0,d.Dn)(String(r),6,6e4))return o.NextResponse.json({message:"Rate limit exceeded"},{status:429});let n=function(e){let t={};return(!e.firstName||String(e.firstName).trim().length<2)&&(t.firstName="Please enter a first name (2+ chars)"),(!e.lastName||String(e.lastName).trim().length<2)&&(t.lastName="Please enter a last name (2+ chars)"),e.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(t.email="Please enter a valid email"),(!e.company||String(e.company).trim().length<2)&&(t.company="Please enter a company name"),e.inquiryType||(t.inquiryType="Please select an inquiry type"),(!e.dataInterest||Array.isArray(e.dataInterest)&&0===e.dataInterest.length)&&(t.dataInterest="Select at least one data interest"),e.businessSize||(t.businessSize="Select your business size"),(!e.message||String(e.message).trim().length<10)&&(t.message="Please enter a message (10+ chars)"),e.privacyAccepted||void 0===e.privacyAccepted||(t.privacy="You must accept the Privacy Policy"),{valid:0===Object.keys(t).length,errors:t}}(a);if(!n.valid)return o.NextResponse.json({message:"Validation failed",errors:n.errors},{status:400});let s=process.env.RECAPTCHA_SECRET;if(s){let e="string"==typeof a.recaptchaToken?a.recaptchaToken:void 0;if(!e)return o.NextResponse.json({message:"reCAPTCHA token missing"},{status:400});try{let t=new URLSearchParams;t.append("secret",s),t.append("response",e);let a=await fetch("https://www.google.com/recaptcha/api/siteverify",{method:"POST",body:t}),r=await a.json(),n="number"==typeof r.score?r.score:0;if(!r.success||n<.5)return o.NextResponse.json({message:"reCAPTCHA verification failed"},{status:400})}catch(e){return o.NextResponse.json({message:"reCAPTCHA verification error"},{status:500})}}let i=`New contact form: ${String(a.inquiryType??"Contact")}`,c=`<p>New contact submission</p><pre>${JSON.stringify(a,null,2)}</pre>`,l=a.attachment;return await m({subject:i,html:c,attachments:l?[l]:void 0}),o.NextResponse.json({ok:!0})}catch(e){return o.NextResponse.json({message:e instanceof Error?e.message:"Server error"},{status:500})}}let y=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/contact/route",pathname:"/api/contact",filename:"route",bundlePath:"app/api/contact/route"},resolvedPagePath:"F:\\Local Disk F\\EGTestVietnam\\vietnam-trade-data\\app\\api\\contact\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:x}=y,S="/api/contact/route";function w(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:v})}},79458:(e,t,a)=>{a.d(t,{Dn:()=>o});let r=null,n=!1;async function s(){if(!n){n=!0;try{let e=await a.e(197).then(a.t.bind(a,62197,23)).catch(()=>null);if(!e){r=null;return}let t=e.default??e,n=process.env.REDIS_URL;n&&(r=new t(n))}catch(e){r=null}}}let i=new Map;async function o(e,t=5,a=6e4){if(await s(),r){let n=`rl:${e}`;try{let e=await r.incr(n);return 1===e&&await r.expire(n,Math.ceil(a/1e3)),e<=t}catch(e){}}let n=Date.now(),o=(i.get(e)||[]).filter(e=>n-e<a);return!(o.length>=t)&&(o.push(n),i.set(e,o),!0)}},66677:(e,t,a)=>{a.d(t,{Z:()=>r});function r(e){return null==e?"":("string"==typeof e?e:String(e)).replace(/[&<>"'`]/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";case"`":return"&#96;";default:return e}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,972],()=>a(26420));module.exports=r})();